- url: 'https://github.com/shadow-robot/ethercat_grant/issues/4'
  title: rpath problems in melodic
  body: "In bionic/melodic, as user, I roslaunch _sr_ethercat_hand_config_ sr_rhand.launch  which internally call a rosrun of the _ros_ethercat_loop_  prefixed with _ethercat_grant_\r\n\r\nI get a _librosconsole_bridge_ not found, although it is installed.\r\n\r\nif I ldd ros_ethercat_loop as user, it finds the lib, but not as root as root, it does not finds the lib\r\n\r\nWhat we tested : \r\n\r\n* added a run dependency to rosconsole_bridge in package.xml of ros_ethercat_loop => nothing changes\r\n* added it as build dependency + a findpackage of rosconsole_bridge => did not work\r\n* it seems to be a bew RUN_PATH/RPATH problem mentioned here  https://stackoverflow.com/questions/47117443/dynamic-linking-with-rpath-not-working-under-ubuntu-17-10\r\n\r\nSo we tried the solution they suggest, directly in _ros_ethercat_loop_, and add this flag `-Wl,--disable-new-dtags`\r\n\r\n* BIONIC without this new flag \r\n```\r\nreadelf -f ros_ethercat_loop \r\n     0x000000000000001d (RUNPATH)            Library runpath: [/vol/famula/bionic/lib:/vol/famula/bionic/ros/melodic/lib:/vol/famula/bionic/ros/melodic/lib:/opt/ros/melodic/lib]\r\n\r\nLD_DEBUG=libs ldd ros_ethercat_loop | grep rosconsole_bridge -A 5\r\n   find library=librosconsole_bridge.so [0]; searching\r\n    search path=/vol/famula/bionic/lib        (RUNPATH from file ./ros_ethercat_loop)\r\n      trying file=/vol/famula/bionic/lib/librosconsole_bridge.so\r\n   search cache=/etc/ld.so.cache\r\n   search path=(.....)/usr/lib/x86_64:/usr/lib        (system search path)\r\n```\r\n* BIONIC with this new flag (the RUNPATH is not RPATH again), but still not found\r\n```\r\nreadelf -f ros_ethercat_loop \r\n 0x000000000000000f (RPATH)              Library rpath: [/vol/famula/bionic/ros/melodic/lib:/opt/ros/melodic/lib:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::]\r\n\r\nLD_DEBUG=libs ldd ros_ethercat_loop | grep rosconsole_bridge -A 5\r\n    find library=librosconsole_bridge.so [0]; searching\r\n     search path=/vol/famula/bionic/lib        (RPATH from file ./ros_ethercat_loop)\r\n       trying file=/vol/famula/bionic/lib/librosconsole_bridge.so\r\n     search cache=/etc/ld.so.cache\r\n     search path=(....)/usr/lib/x86_64:/usr/lib        (system search path)\r\n```\r\n\r\n* XENIAL works nice\r\n```\r\nreadelf -f ros_ethercat_loop\r\n   0x000000000000000f (RPATH)              Library rpath: [/vol/famula/nightly/lib:/vol/famula/nightly/ros/kinetic/lib:/opt/ros/kinetic/lib]\r\n\r\nLD_DEBUG=libs ldd ros_ethercat_loop | grep rosconsole_bridge -A 5\r\n   find library=librosconsole_bridge.so [0]; searching\r\n    search path=/vol/famula/nightly/lib        (RPATH from file ./ros_ethercat_loop)\r\n     trying file=/vol/famula/nightly/lib/librosconsole_bridge.so\r\n    search path=/vol/famula/nightly/lib:/vol/famula/nightly/ros/kinetic/lib:/opt/ros/kinetic/lib:/opt/ros/kinetic/lib/x86_64-linux-gnu        (RPATH from file ./ros_ethercat_loop)\r\n     trying file=/vol/famula/nightly/lib/librosconsole_bridge.so\r\n     trying file=/vol/famula/nightly/ros/kinetic/lib/librosconsole_bridge.so\r\n     trying file=/opt/ros/kinetic/share/euslisp/jskeus/eus//Linux64/lib/librosconsole_bridge.so\r\n     trying file=/opt/ros/kinetic/lib/librosconsole_bridge.so\r\n```\r\n\r\nSo dependent libraries are not deployed in a consistent way yet to use the RUNPATH or backward-compatible RPATH (like libros-*-urdf)\r\n\r\n@rhaschke has an idea how to solve this, and we will test it on our side. Please hold on a few days, until we provide a PR.\r\n"
  repo: 'https://api.github.com/repos/shadow-robot/ethercat_grant'
  labels: []
